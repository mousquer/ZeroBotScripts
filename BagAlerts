-- Configuração inicial
local ICON_X_POSITION = 150  -- Posição inicial X do ícone
    local ICON_Y_POSITION = 100  -- Posição inicial Y do ícone
    local ICON_ID = 34109  -- ID do ícone para exibição (substitua por um ID válido)
    local POSITION_FILE = Engine.getScriptsDirectory() .. "\\bag_position.txt" -- Caminho do arquivo de posição
    local alertSoundDesire = Engine.getScriptsDirectory() .. "\\sounds\\BagYouDesire.wav" -- Caminho do som de alerta
    local alertSoundCovet = Engine.getScriptsDirectory() .. "\\sounds\\BagYouCovet.wav"
    local alertSoundGranCovet = Engine.getScriptsDirectory() .. "\\sounds\\GrandBagYouCovet.wav"
    
    -- Contadores para os itens
    local BagYouDesireCount = 0
    local BagYouCovetCount = 0
    local GrandBagYouCovetCount = 0
    
    -- Função para salvar posição no arquivo
    local function savePosition(x, y)
        local file = io.open(POSITION_FILE, "w")
        if file then
            file:write(string.format("%d,%d", x, y))
            file:close()
        end
    end
    
    -- Função para carregar posição do arquivo
    local function loadPosition()
        local file = io.open(POSITION_FILE, "r")
        if file then
            local line = file:read("*line")
            file:close()
            if line then
                local x, y = line:match("^(%-?%d+),(%-?%d+)$")
                return tonumber(x), tonumber(y)
            end
        end
        return ICON_X_POSITION, ICON_Y_POSITION -- Retorna posição inicial padrão caso não exista o arquivo
    end
    
    -- Carrega a posição salva ou usa a posição padrão
    local iconX, iconY = loadPosition()
    
    -- Criação do HUD para o contador
    local bagIcon = HUD.new(iconX, iconY, ICON_ID, true)
    bagIcon:setDraggable(true)
    bagIcon:setHorizontalAlignment(Enums.HorizontalAlign.Left)
    
    local BagYouDesireHud = HUD.new(iconX - 50, iconY + 40, "Bag You Desire: 0", true)
    BagYouDesireHud:setColor(0, 250, 154)
    BagYouDesireHud:setHorizontalAlignment(Enums.HorizontalAlign.Left)
    
    local BagYouCovetHud = HUD.new(iconX - 50, iconY + 60, "Bag You Covet: 0", true)
    BagYouCovetHud:setColor(255, 165, 0)
    BagYouCovetHud:setHorizontalAlignment(Enums.HorizontalAlign.Left)
    
    local GrandBagYouCovetHud = HUD.new(iconX - 50, iconY + 80, "Grand Bag You Covet: 0", true)
    GrandBagYouCovetHud:setColor(255, 69, 0)
    GrandBagYouCovetHud:setHorizontalAlignment(Enums.HorizontalAlign.Left)
    
    -- Função que verifica mensagens no chat contendo os itens
    Game.registerEvent(Game.Events.TEXT_MESSAGE, function(data)
        local text = data.text:lower()

        if text:find("from a bag you desire") or text:find("from a bag you covet") or text:find("from a gran bag you covet")then
            return
        end
    
        -- Verifica se caiu "Bag You Desire"
        if text:find("bag you desire") then
            BagYouDesireCount = BagYouDesireCount + 1
            BagYouDesireHud:setText("Bag You Desire: " .. BagYouDesireCount)
            Sound.play(alertSoundDesire) -- Toca som de alerta
        end
    
        -- Verifica se caiu "Bag You Covet"
        if text:find("bag you covet") and not text:find("grand bag you covet") then
            BagYouCovetCount = BagYouCovetCount + 1
            BagYouCovetHud:setText("Bag You Covet: " .. BagYouCovetCount)
            Sound.play(alertSoundCovet) -- Toca som de alerta
        end
    
        -- Verifica se caiu "Grand Bag You Covet"
        if text:find("grand bag you covet") then
            GrandBagYouCovetCount = GrandBagYouCovetCount + 1
            GrandBagYouCovetHud:setText("Grand Bag You Covet: " .. GrandBagYouCovetCount)
            Sound.play(alertSoundGranCovet) -- Toca som de alerta
        end
    end)

    
    
    -- Timer para monitorar se o HUD foi arrastado e salvar nova posição
    Timer.new("handle-bag-hud", function()
        local currentIconPos = bagIcon:getPos()
        BagYouDesireHud:setPos(currentIconPos.x - 50, currentIconPos.y + 40)
        BagYouCovetHud:setPos(currentIconPos.x - 50, currentIconPos.y + 60)
        GrandBagYouCovetHud:setPos(currentIconPos.x - 50, currentIconPos.y + 80)
        savePosition(currentIconPos.x, currentIconPos.y) -- Salva a nova posição
    end, 1000)
    
